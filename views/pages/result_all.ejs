<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="/style/main.css"> -->
    <link rel="stylesheet" href="/style/card.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="/js/script.js"></script>
    <title>Quiz page</title>
</head>

<style>
    .body {
        padding:12% 15%;
    }
    .card {        
        background: #FFFFFF;
        border-radius: 25px;
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.5);
    }

    .module {
        width: 30%;
        margin: 0% 3%;
        text-align: center;
        padding: 5% 2%;
        margin-top: 2%;
    }
    .module-h {
        margin-bottom: 10%;
    }

    #tips {
        padding: 5%;
        margin: 4% 0%;
    }

    .tips-li {
        display: flex;
        margin-top: 2%;
    }

    #vd {
        display: flex;
        justify-content: center;
    }

    .vd-chart {
        margin: 0% -40px;
    }

    #vd-text-mc {
        display: flex;
        flex-direction: column;
        align-items: start;
        padding-top: 5%;
        margin-right: -4%;
        z-index: 1;
    }

    #vd-text-oc {
        display: flex;        
        flex-direction: column;
        justify-content: end;     
        padding-bottom: 5%;   
        margin-left: -4%;
        z-index: 1;
    }

    .mDetails {
        max-height: none;
    }

    .m-result {
        width: 30%;
        padding: 3%;
        margin: 0% 3%;
    }
</style>

<body>
    <!-- Navbar -->
    <header class="z-10">
        <%- include ('../partials/nav.ejs') %>
    </header>
    
    <!-- Body -->
    <div class="body">
        <!-- Module -->
        <div class="w-full mx-auto bg-white">
            <!-- Text -->
            <div class="textBox text-center">
                <p class="text-slate-900 text-4xl mb-2">Your business is</p>
                <p class="text-slate-900 text-4xl mb-2 font-bold"><%= business_category %></p>                
            </div>
            
            <!-- Venn diagram -->
            <div id="vd" class="">
                <!-- market creation -->
                <div id="vd-text-mc">
                    <p >Market Creation</p>
                </div>
                <div id="vd-mc" class="vd-chart"></div>              
                <!-- organisational change -->
                <div id="vd-oc" class="vd-chart"></div> 
                <div id="vd-text-oc">
                    <p>Organisational Change</p>
                </div>             
            </div>               

            <!-- Cards -->
            <div id="modules" class="flex justify-center">
                <!-- market creation -->
                <div id="card-1" class="card module">
                    <!-- heading -->
                    <div class="module-h">
                        <p class="text-slate-900 text-1xl">Market Creation</p>
                    </div>
                    <!-- button -->
                    <div class="buttons mx-auto text-center">
                        <a href="#" class="px-4 py-3 bg-transparent border-gray-900 border rounded-full text-gray-900 hover:bg-gray-900 hover:text-white">
                            Click here
                        </a>
                    </div>
                </div>
                <!-- market creation -->
                <div id="card-2" class="card module">
                    <!-- heading -->
                    <div class="module-h">
                        <p class="text-slate-900 text-1xl">Organisational Change</p>
                    </div>
                    <!-- button -->
                    <div class="buttons mx-auto text-center">
                        <a href="#" class="px-4 py-3 bg-transparent border-gray-900 border rounded-full text-gray-900 hover:bg-gray-900 hover:text-white">
                            Click here
                        </a>
                    </div>
                </div>
                <!-- market creation -->
                <div id="card-3" class="card module">
                    <!-- heading -->
                    <div class="module-h">
                        <p class="text-slate-900 text-1xl">Implementation</p>
                    </div>
                    <!-- button -->
                    <div class="buttons mx-auto text-center">
                        <a href="#" class="px-4 py-3 bg-transparent border-gray-900 border rounded-full text-gray-900 hover:bg-gray-900 hover:text-white">
                            Click here
                        </a>
                    </div>
                </div>            
            </div>        
        </div>
        
        <!-- Desciption -->        
        <div class="mt-16">
            <!-- heading -->
            <p class="text-slate-900 text-4xl mb-2 font-bold">What is Emerging Pioneer ?</p>
            <!-- par -->
            <p class="mt-10 text-slate-900 text-sm mx-auto">Don't mistake this love language for materialism; the receiver of gifts thrives on the love, thoughtfulness, and effort behind the gift. If you speak this love language, the perfect gift or gesture shows that you are known, you are cared for, and you are prized above whatever was sacrificed to bring the gift to you.Don't mistake this love language for materialism; the receiver of gifts thrives on the love, thoughtfulness, and effort behind the gift. </p>
        </div>

        <!-- Tips -->
        <div id="tips" class="card tips">
            <!-- heading -->
            <p class="text-slate-900 text-xl font-medium mx-auto">Steps to improve your Business:</p>
            <!-- list of tips -->
            <p>Don't mistake this love language for materialism: </p>
            <ul class="mt-5 pl-5">
                <li class="tips-li">
                    <p class="w-16 list-number text-2xl">1.</p>
                    <p class="">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam mauris metus, ultricies at ex nec, suscipit scelerisque diam. Suspendise neque sem, elementum et nunc eget, placerat tincidunt augue. Maecenas ullamcorper nisl eget metus sagittis, in scelerisque risus molestie. Donec ac finibus nunc. </p>
                </li>    
                <li class="tips-li">
                    <p class="w-16 list-number text-2xl">2.</p>
                    <p class="">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam mauris metus, ultricies at ex nec, suscipit scelerisque diam. Suspendise neque sem, elementum et nunc eget, placerat tincidunt augue. Maecenas ullamcorper nisl eget metus sagittis, in scelerisque risus molestie. Donec ac finibus nunc. </p>
                </li>         
                <li class="tips-li">
                    <p class="w-16 list-number text-2xl">3.</p>
                    <p class="">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam mauris metus, ultricies at ex nec, suscipit scelerisque diam. Suspendise neque sem, elementum et nunc eget, placerat tincidunt augue. Maecenas ullamcorper nisl eget metus sagittis, in scelerisque risus molestie. Donec ac finibus nunc.</p>
                </li>         
            </ul>            
        </div>

        <% for (m in modules) { %>
        <!-- Module Details Dropdown -->
        <div class="">
            <!-- Dropdown -->
            <div class="border-gray-200 border-b">
                <button data-collapse-toggle="more-details-<%= modules[m].code %>" type="button" class="text-lg text-black font-medium inline-flex w-full justify-between py-6">
                    <!-- Question topic -->                    
                    <span class="inline-flex items-cente">
                        <span class="mr-2"><%= modules[m].name %></span>
                        <span class="mr-2">icon</span>
                    </span>
                    <!-- Dropdown button -->
                    <span class="">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                        </svg>
                    </span>
                </button>

                <!-- Module Details -->
                <div id="more-details-<%= modules[m].code %>" class="m-details w-full mb-10 pb-5 mx-auto bg-white hidden overflow-y-auto transition-all duration-5000 ease-in-out">                    
                    
                    <!-- Half radial chart -->
                    <div id="hrc-<%= modules[m].code %>" class="-mb-16"></div>

                    <!-- Cards -->
                    <div class="q-graphs flex justify-center">
                        <% for (q in scores[modules[m].code].qScores) { %>
                            <!-- card -->
                            <div id="card-<%= q %>" class="card m-result text-center">
                                <!-- radial bar -->
                                <div id="rb-<%= q %>"></div>
                                <!-- heading -->
                                <p class="text-slate-900 text-1xl font-medium mx-auto"><%= scores[modules[m].code].qScores[q].topic %></p>
                                <!-- resutl -->
                                <p class="text-slate-900 text-sm mx-auto"><%= cat[scores[modules[m].code].qScores[q].label]['label'] %></p>
                            </div>                    
                        <% }; %>
                    </div>
                </div>
            </div>
        </div>
        <% }; %>

        <!-- button -->
        <div class="buttons mt-10 text-center">
            <a href="#" class="px-6 py-5 mt-10 bg-transparent border-gray-900 border rounded-full text-gray-900 hover:bg-gray-900 hover:text-white">
                Go back to home
            </a>
        </div>

        <div id="chart"></div>
        
    </div>
</body>
</html>

<script type='text/javascript'> 
// Retrieve data from server
let modules = JSON.parse('<%= JSON.stringify(modules) %>'.replace(/&#34;/g, '"'));
let data = JSON.parse('<%= JSON.stringify(data) %>'.replace(/&#34;/g, '"'));
let scores = JSON.parse('<%= JSON.stringify(scores) %>'.replace(/&#34;/g, '"'));
let cat = JSON.parse('<%= JSON.stringify(cat) %>'.replace(/&#34;/g, '"'));
console.log(modules);
console.log(data);
console.log(scores);

window.onload = function() {
    // Overall result -> Venn diagram
    for (const m in scores) {
        // Init
        let mScore = scores[m].mScore   
        let maxScore = 6; 

        // Module score
        let mScoreAggregate = 0;
        for (q in scores[m].qScores) {
            mScoreAggregate += scores[m].qScores[q].label
        }     
        let mScorePercentage = parseInt(mScoreAggregate/6*100);
        
        // Venn diagram
        insertVennRadialChart(`vd-${m}`, cat[mScore]['label'], cat[mScore]['color'], '#00000000', '300px', '85%', cat[mScore]['color2']+'7F', mScorePercentage)

        // Question radial chart
        insertHalfRadialChart(`hrc-${m}`, cat[mScore]['label'], cat[mScore]['color'], cat[mScore]['color2'], '100%', '50%', mScorePercentage)
    }

    // Module result -> Half radial chart

    // insertHalfRadialChart('hrc', 'emerging', '#89EFCD', '#FFE37E', '100%', '50%', 20)

    // // Questions result -> Radial chart
    // insertRadialChart('rc-1', 'emerging', '#89EFCD', '#FFE37E', '100%', '50%', 20)

    // // Progress bar chart    
    // document.getElementById('d2-pb').appendChild(createProgressChart())
}
</script>
